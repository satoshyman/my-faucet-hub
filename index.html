<script src='//libtl.com/sdk.js' data-zone='10428594' data-sdk='show_10428594'></script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BeeClaimer- Perfect Fit</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;900&display=swap" rel="stylesheet">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #FFD700; --card-bg: rgba(18, 18, 18, 0.8); --border: rgba(255, 215, 0, 0.2); --spacing: 12px; }
        body { margin: 0; padding: 0; height: 100vh; background: #000; color: white; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        .bg-glow { position: fixed; inset: 0; background: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #000 80%); z-index: -1; }
        .container { width: 100%; max-width: 420px; padding: 10px; box-sizing: border-box; display: flex; flex-direction: column; height: 100vh; }
        .app-title { font-weight: 900; color: var(--gold); letter-spacing: 2px; font-size: clamp(18px, 5vw, 22px); margin: 10px 0; text-align: center; text-transform: uppercase; flex-shrink: 0; cursor: pointer; }
        .page { display: none; width: 100%; flex-direction: column; flex-grow: 1; margin-bottom: 80px; }
        .active-page { display: flex; animation: fadeIn 0.3s ease; }
        
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.8) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .wallet-card { width: 100%; background: linear-gradient(135deg, #1e1b0a 0%, #000000 100%); border-radius: 25px; border: 1px solid var(--gold); padding: 20px; box-sizing: border-box; text-align: center; margin-bottom: var(--spacing); box-shadow: 0 10px 30px rgba(255, 215, 0, 0.1); flex-shrink: 0; transition: transform 0.2s; }
        .wallet-card:active { transform: scale(0.98); }
        .bal-label { font-size: 11px; font-weight: 800; color: var(--gold); opacity: 0.8; text-transform: uppercase; }
        .bal-val { font-size: clamp(30px, 10vw, 45px); font-weight: 900; margin: 5px 0; color: #fff; letter-spacing: -1px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; flex-grow: 1; align-content: stretch; }
        .card { border-radius: 22px; padding: 15px 10px; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 8px 20px rgba(0,0,0,0.3); justify-content: space-between; }
        .card:active { transform: scale(0.95); }
        
        .icon-box { display: inline-block; transition: transform 0.3s ease; }
        .ready-glow { animation: readyPulse 2s infinite; border-color: var(--gold); }
        .ready-glow .icon-box { animation: iconWobble 1.5s infinite ease-in-out; }
        
        @keyframes readyPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }
        @keyframes iconWobble { 0% { transform: scale(1) rotate(0deg); } 25% { transform: scale(1.1) rotate(5deg); } 50% { transform: scale(1.1) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); } }
        
        .card-daily { background: linear-gradient(135deg, #2d1b4e 0%, #160d26 100%); border-color: #6c4ab6; }
        .card-mine { background: linear-gradient(135deg, #0f2d4e 0%, #061626 100%); border-color: #007bff; }
        .card-faucet { grid-column: span 2; flex-direction: row; justify-content: space-between; padding: 12px 20px; align-items: center; background: linear-gradient(135deg, #4e3a0f 0%, #261c06 100%); border-color: #ff9900; max-height: 80px; margin-top: 5px; }
        .btn-main { background: var(--gold); color: #000; border: none; padding: 12px; border-radius: 16px; font-weight: 900; width: 100%; cursor: pointer; font-size: 12px; transition: 0.2s; text-transform: uppercase; }
        .btn-main:active { transform: scale(0.92); }
        .btn-main:disabled { background: rgba(0,0,0,0.4); color: #777; cursor: not-allowed; border: 1px solid rgba(255,255,255,0.1); }
        .btn-small { padding: 10px; font-size: 11px; margin-top: 10px; }
        .timer-text { font-size: 12px; color: #fff; font-weight: 800; margin-top: 5px; display: block; text-shadow: 0 2px 4px rgba(0,0,0,0.5); background: rgba(0,0,0,0.3); padding: 4px 10px; border-radius: 10px; }
        .speed-up-tag { position: absolute; top: -10px; right: 10px; background: #ff3b3b; color: white; font-size: 9px; padding: 5px 12px; border-radius: 20px; font-weight: 900; display: none; box-shadow: 0 4px 10px rgba(255, 59, 59, 0.3); z-index: 10; cursor: pointer; }
        .nav-bar { position: fixed; bottom: 15px; width: 92%; max-width: 380px; background: rgba(18,18,18,0.95); border: 1px solid var(--border); height: 70px; border-radius: 25px; display: flex; justify-content: space-around; align-items: center; backdrop-filter: blur(20px); z-index: 1000; }
        .nav-item { text-align: center; opacity: 0.3; transition: 0.3s; flex: 1; cursor: pointer; }
        .nav-item.active { opacity: 1; color: var(--gold); transform: translateY(-5px); }
        .nav-item span { font-size: 11px; font-weight: 800; display: block; margin-top: 6px; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 99999; justify-content: center; align-items: center; padding: 25px; backdrop-filter: blur(8px); }
        .modal-content { background: #0f0f0f; width: 100%; max-width: 360px; border-radius: 35px; border: 1px solid var(--gold); padding: 30px; box-sizing: border-box; text-align: center; animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-height: 90vh; overflow-y: auto; }
        
        .withdraw-history { margin-top: 20px; text-align: left; background: rgba(255,255,255,0.03); border-radius: 20px; padding: 15px; border: 1px solid rgba(255,215,0,0.1); }
        .history-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 10px; }
        .history-item:last-child { border-bottom: none; }
        
        .ref-withdraw-box { margin-top: 20px; padding: 12px; border: 1px solid rgba(255, 215, 0, 0.15); background: rgba(255, 255, 255, 0.03); border-radius: 18px; font-size: 11px; }
        .ref-withdraw-box a { color: var(--gold); text-decoration: none; font-weight: bold; }
        .amt-tag { font-size: 11px; color: var(--gold); font-weight: 900; margin-bottom: 5px; }
        .ref-stats-container { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .ref-stat-card { background: rgba(255, 215, 0, 0.05); border: 1px solid rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 10px; flex: 1; }
        .ref-stat-card small { font-size: 9px; color: var(--gold); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .ref-stat-card span { font-size: 16px; font-weight: 900; }
        .amc-modal { display: none; position: fixed; inset: 0; background: #000; z-index: 100000; overflow-y: auto; padding: 20px; }
        .amc-card { background: #111; border: 1px solid #333; border-radius: 20px; padding: 15px; margin-bottom: 15px; }
        .amc-label { display: block; font-size: 11px; color: var(--gold); margin: 10px 0 5px 0; text-transform: uppercase; font-weight: bold; }
        .amc-input { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 12px; box-sizing: border-box; outline: none; font-size: 13px; }
        .amc-btn { background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 15px; width: 100%; font-weight: 900; margin-top: 10px; cursor: pointer; text-transform: uppercase; }
        .amc-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .amc-stat-box { background: #000; padding: 12px; border-radius: 15px; text-align: center; border: 1px solid #222; }
        .withdraw-input-group { position: relative; width: 100%; margin-bottom: 15px; }
        .max-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: var(--gold); color: #000; border: none; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

    <div class="bg-glow"></div>

    <div class="container">
        <div class="app-title" id="titleHandler">BeeClaimer </div>

        <div id="homePage" class="page active-page">
            <div class="wallet-card">
                <div class="bal-label">Total Available Balance</div>
                <div class="bal-val">
                    <span style="color: #0088cc; font-size: 32px; filter: drop-shadow(0 0 8px #0088cc);">üíé</span>
                    <span id="mainBal">0.0000</span> 
                    <small style="font-size: 16px; opacity: 0.4;">TON</small>
                </div>
                <button class="btn-main" onclick="openModal('wModal')" style="width: 70%; margin: 8px auto 0 auto;">Withdraw Funds</button>
            </div>

            <div class="grid">
                <div class="card card-daily ready-glow" id="dailyCard">
                    <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <span class="icon-box" style="font-size:35px;">üéÅ</span>
                        <h3 style="font-size:13px; margin:8px 0 2px 0; color: #d1b3ff;">Daily Gift</h3>
                        <div class="amt-tag" id="ui_daily_val">(+0.0001)</div>
                        <span id="dailyTimer" class="timer-text">Ready</span>
                    </div>
                    <button id="dailyBtn" class="btn-main btn-small" onclick="claimDaily()">Claim Bonus</button>
                </div>

                <div class="card card-mine ready-glow" id="mineCard">
                    <div id="speedMineTag" class="speed-up-tag" onclick="speedUp('mine')" style="display: block;">‚ö° SPEED UP</div>
                    <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <span class="icon-box" style="font-size:35px;">‚õèÔ∏è</span>
                        <h3 style="font-size:13px; margin:8px 0 2px 0; color: #b3d9ff;">Mining</h3>
                        <div class="amt-tag" id="ui_mine_val" style="color:#007bff;">(+0.00001)</div>
                        <span id="mineTimer" class="timer-text">Ready</span>
                    </div>
                    <button id="mineBtn" class="btn-main btn-small" onclick="startAction('mine')">Start</button>
                </div>

                <div class="card card-faucet ready-glow" id="faucetCard">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <span class="icon-box" style="font-size:34px;">üçØ</span>
                        <div style="text-align:left;">
                            <h3 style="margin:0; font-size:14px; color: #ffd9b3;">Honey Faucet</h3>
                            <div class="amt-tag" id="ui_faucet_val" style="margin:0; font-size:10px;">(+0.00001)</div>
                            <span id="faucetTimer" class="timer-text">Ready</span>
                        </div>
                    </div>
                    <button id="faucetBtn" class="btn-main" style="width:110px;" onclick="startAction('faucet')">Claim</button>
                </div>
            </div>
        </div>

        <div id="refPage" class="page">
            <div class="wallet-card" style="flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
                <span style="font-size:60px;">üë•</span>
                <h2 style="margin:15px 0 10px 0;">Referral Hub</h2>
                <div class="ref-stats-container">
                    <div class="ref-stat-card"><small>Total Friends</small><span id="friendCount">0</span></div>
                    <div class="ref-stat-card"><small>Commission Earned</small><span id="refCommission">0.0000</span></div>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; font-size:12px; color:var(--gold); margin-bottom: 20px;">ü§ù Earn <span id="ui_ref_percent">10</span>% commission instantly!</div>
                <div style="background:#000; border:1px dashed var(--border); padding:16px; border-radius:15px; font-size:11px; word-break:break-all; color:#aaa;" id="refURL">Loading...</div>
                <button class="btn-main" style="margin-top:25px; width: 80%; align-self: center;" onclick="copyRef()">Copy Link</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" id="navHome" onclick="showPage('home')">üè†<span>Home</span></div>
        <div class="nav-item" id="navRef" onclick="showPage('ref')">üë•<span>Friends</span></div>
    </div>

    <div id="wModal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--gold); margin:0 0 10px 0;">Withdraw</h2>
            <div style="font-size: 13px; color: #888; margin-bottom: 20px;">Min Payout: <b id="ui_min_withdraw" style="color:#fff;">0.0001</b> TON</div>
            
            <input type="email" id="emailInp" placeholder="FaucetPay Email Address" style="width:100%; padding:15px; border-radius:15px; border:1px solid #333; background:#000; color:#fff; text-align:center; margin-bottom:12px; box-sizing:border-box; outline:none; font-size: 13px;">
            
            <div class="withdraw-input-group">
                <input type="number" id="withdrawAmtInp" placeholder="Amount to Withdraw" step="0.0001" style="width:100%; padding:15px; border-radius:15px; border:1px solid #333; background:#000; color:#fff; text-align:center; box-sizing:border-box; outline:none; font-size: 13px;">
                <button class="max-btn" onclick="setMaxWithdraw()">MAX</button>
            </div>
            
            <button class="btn-main" id="withdrawBtn" onclick="processWithdraw()" style="margin-top:10px;">Request Payout</button>
            
            <div class="withdraw-history">
                <div style="font-size: 11px; font-weight: 900; color: var(--gold); border-bottom: 1px solid rgba(255,215,0,0.2); padding-bottom: 5px; margin-bottom: 8px; text-transform: uppercase;">Recent History</div>
                <div id="userWithdrawList" style="max-height: 120px; overflow-y: auto;">
                    <div style="font-size:10px; opacity:0.5; text-align:center; padding:10px;">No records yet</div>
                </div>
            </div>

            <div class="ref-withdraw-box">Don't have a FaucetPay wallet?<br><a href="https://faucetpay.io/?r=362774" target="_blank">Register here</a></div>
            <div onclick="closeModal('wModal')" style="margin-top:25px; font-size:13px; opacity:0.6; cursor:pointer; font-weight:700;">Close Window</div>
        </div>
    </div>

    <div id="successModal" class="modal-overlay"><div class="modal-content"><span id="successIcon" style="font-size: 70px;">‚úÖ</span><h2 id="successTitle" style="margin:20px 0 10px 0;">Awesome!</h2><div id="successAmt" style="color:var(--gold); font-size: 36px; font-weight: 900; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px;"><span style="color: #0088cc; font-size: 30px;">üíé</span><span id="amtText">+0.00001</span></div><button class="btn-main" onclick="closeModal('successModal')">Collect</button><button class="btn-main" style="margin-top:15px; background:#00ff88; font-size:12px;" onclick="doubleReward()">üî• Double Reward (Ad)</button></div></div>
    <div id="amcPanel" class="amc-modal"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;"><h2 style="color:var(--gold); margin:0;">SUPER AMC v3.0</h2><button onclick="closeAmc()" style="background:red; color:white; border:none; padding:8px 15px; border-radius:10px; font-weight:bold;">X</button></div><div class="amc-card"><div class="amc-stats-grid"><div class="amc-stat-box"><small style="color:#666;">Users</small><br><b id="amc_total_users">0</b></div><div class="amc-stat-box"><small style="color:#666;">Requests</small><br><b id="amc_total_req">0</b></div></div></div><div class="amc-card"><h3 style="font-size:14px; color:var(--gold); border-bottom:1px solid #333; padding-bottom:10px;">üîë Security & API</h3><label class="amc-label">FaucetPay API Key</label><input type="text" id="inp_api" class="amc-input" placeholder="Paste FaucetPay API Key"></div><div class="amc-card"><h3 style="font-size:14px; color:var(--gold); border-bottom:1px solid #333; padding-bottom:10px;">üí∞ Rewards & Limits</h3><label class="amc-label">Mining Reward</label><input type="number" id="inp_mine" class="amc-input" step="0.00001"><label class="amc-label">Faucet Reward</label><input type="number" id="inp_faucet" class="amc-input" step="0.00001"><label class="amc-label">Daily Bonus</label><input type="number" id="inp_daily" class="amc-input" step="0.0001"><label class="amc-label">Min Withdraw</label><input type="number" id="inp_min" class="amc-input" step="0.0001"><label class="amc-label">Ref Commission %</label><input type="number" id="inp_ref" class="amc-input"></div><div class="amc-card"><h3 style="font-size:14px; color:#00ff88; border-bottom:1px solid #333; padding-bottom:10px;">üì¢ Ads Links</h3><label class="amc-label">Mining Ad URL</label><input type="text" id="ad_mine" class="amc-input"><label class="amc-label">Faucet Ad URL</label><input type="text" id="ad_faucet" class="amc-input"><label class="amc-label">Daily Ad URL</label><input type="text" id="ad_daily" class="amc-input"><label class="amc-label">Double Ad URL</label><input type="text" id="ad_double" class="amc-input"></div><button class="amc-btn" onclick="saveAmcSettings()">SAVE ALL CHANGES</button><div class="amc-card" style="margin-top:20px;"><h3 style="font-size:14px; color:var(--gold);">üí∏ Payout History</h3><div id="amc_req_list"></div></div></div>

<script>
    const tele = window.Telegram.WebApp;
    tele.ready();
    tele.expand();

    const teleUser = tele.initDataUnsafe?.user;

    function triggerAd(adType, callback) {
        if (typeof show_10428594 === 'function') {
            show_10428594().then(() => { if(callback) callback(); }).catch(e => { if(callback) callback(); });
        } else { if(callback) callback(); }
    }

    const firebaseConfig = {
      apiKey: "AIzaSyDVj2Mda_x16XiegcR0Mqk5fWI4m7BlrMk",
      authDomain: "beecfaucet.firebaseapp.com",
      databaseURL: "https://beecfaucet-default-rtdb.firebaseio.com",
      projectId: "beecfaucet",
      storageBucket: "beecfaucet.firebasestorage.app",
      messagingSenderId: "867086977888",
      appId: "1:867086977888:web:415084058e5b0ad369ec05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let config = { 
        rewards: { mine: 0.00001, faucet: 0.00001, daily: 0.0001 }, 
        ads: { mine: "#", faucet: "#", daily: "#", double: "#" }, 
        limits: { min_withdraw: 0.0001, ref_percent: 10 }, 
        api_key: "" 
    };

    let userId = teleUser ? teleUser.id.toString() : (localStorage.getItem('bee_uid') || ('user_' + Math.random().toString(36).substr(2, 9)));
    localStorage.setItem('bee_uid', userId);
    
    const botUsername = "beeclaimer_bot"; 
    const finalRefURL = `https://t.me/${botUsername}?start=${userId}`;
    document.getElementById('refURL').innerText = finalRefURL;

    let balance = 0, friends = 0, refEarned = 0, currentReward = 0;

    let clicks = 0;
    document.getElementById('titleHandler').onclick = () => {
        clicks++;
        if(clicks === 8) { let p = prompt("Admin Password:"); if(p === "Ahmednnn3") openAmc(); clicks = 0; }
        setTimeout(() => clicks = 0, 3000);
    };

    function syncAll() {
        db.ref('app_config').on('value', snap => { if(snap.exists()) { config = snap.val(); updateStaticUI(); } });

        const userRef = db.ref('users/' + userId);
        userRef.once('value', snap => {
            if(!snap.exists()) {
                const params = new URLSearchParams(window.location.search);
                const referrerId = tele.initDataUnsafe?.start_param || params.get('tgWebAppStartParam');
                
                let newUser = { balance: 0, friends: 0, refEarned: 0, joined: Date.now(), uid: userId };
                
                if (referrerId && referrerId !== userId) {
                    newUser.referrer = referrerId;
                    db.ref('users/' + referrerId + '/friends').transaction(curr => (curr || 0) + 1);
                }
                userRef.set(newUser);
            }
            
            userRef.on('value', uSnap => {
                if(uSnap.exists()){
                    let d = uSnap.val();
                    balance = d.balance || 0;
                    friends = d.friends || 0;
                    refEarned = d.refEarned || 0;
                    updateUI();
                }
            });
        });

        db.ref('withdrawals').orderByChild('uid').equalTo(userId).on('value', snap => {
            const list = document.getElementById('userWithdrawList');
            if(snap.exists()) {
                let html = "";
                snap.forEach(child => {
                    let w = child.val();
                    let date = new Date(w.time).toLocaleDateString();
                    html += `
                        <div class="history-item">
                            <div><b>${w.amount}</b> TON <br><small style="opacity:0.6">${date}</small></div>
                            <div style="color:${w.status==='PAID'?'#00ff88':'#ffcc00'}">${w.status}</div>
                        </div>`;
                });
                list.innerHTML = html;
            }
        });

        db.ref('users').on('value', snap => { if(snap.exists()) document.getElementById('amc_total_users').innerText = snap.numChildren(); });
        db.ref('withdrawals').on('value', snap => {
            if(snap.exists()) {
                document.getElementById('amc_total_req').innerText = snap.numChildren();
                let html = "";
                snap.forEach(child => {
                    let w = child.val();
                    html += `<div style="font-size:10px; padding:10px; border-bottom:1px solid #222;">üìß ${w.email} | üí∞ ${w.amount} TON <br><small style="color:${w.status==='PAID'?'#00ff88':'#ffcc00'}">${w.status}</small></div>`;
                });
                document.getElementById('amc_req_list').innerHTML = html;
            }
        });
    }

    function updateStaticUI() {
        document.getElementById('ui_mine_val').innerText = `(+${config.rewards.mine.toFixed(5)})`;
        document.getElementById('ui_faucet_val').innerText = `(+${config.rewards.faucet.toFixed(5)})`;
        document.getElementById('ui_daily_val').innerText = `(+${config.rewards.daily.toFixed(4)})`;
        document.getElementById('ui_min_withdraw').innerText = config.limits.min_withdraw.toFixed(4);
        document.getElementById('ui_ref_percent').innerText = config.limits.ref_percent;
    }

    function updateUI() {
        document.getElementById('mainBal').innerText = balance.toFixed(5);
        document.getElementById('friendCount').innerText = friends;
        document.getElementById('refCommission').innerText = refEarned.toFixed(5);
    }

    function showPage(p) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active-page'));
        document.querySelectorAll('.nav-item').forEach(nv => nv.classList.remove('active'));
        document.getElementById(p + 'Page').classList.add('active-page');
        document.getElementById('nav' + p.charAt(0).toUpperCase() + p.slice(1)).classList.add('active');
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function setMaxWithdraw() { document.getElementById('withdrawAmtInp').value = balance.toFixed(5); }

    function startAction(type) {
        triggerAd('rewarded', () => {
            if(config.ads[type] !== "#") window.Telegram.WebApp.openLink(config.ads[type], {try_instant_view: true});
            localStorage.setItem(type + '_end', Date.now() + (5 * 60 * 1000));
            localStorage.setItem(type + '_active', 'true');
        });
    }

    function claimDaily() {
        const last = localStorage.getItem('last_daily');
        if (!last || (Date.now() - last > 86400000)) {
            triggerAd('pop', () => {
                if(config.ads.daily !== "#") window.Telegram.WebApp.openLink(config.ads.daily, {try_instant_view: true});
                addReward(config.rewards.daily);
                localStorage.setItem('last_daily', Date.now());
                showSuccess(config.rewards.daily, "Daily Bonus", "üéÅ");
            });
        }
    }

    function doubleReward() {
        triggerAd('pop', () => {
            if(config.ads.double !== "#") window.Telegram.WebApp.openLink(config.ads.double, {try_instant_view: true});
            addReward(currentReward);
            closeModal('successModal');
            tele.showAlert("Reward Doubled!");
        });
    }

    function addReward(amt) {
        balance += amt;
        db.ref('users/' + userId).once('value', snap => {
            let userData = snap.val();
            if (userData && userData.referrer) {
                let commission = amt * (config.limits.ref_percent / 100);
                const rRef = db.ref('users/' + userData.referrer);
                rRef.transaction(rData => {
                    if(rData) {
                        rData.balance = (rData.balance || 0) + commission;
                        rData.refEarned = (rData.refEarned || 0) + commission;
                    }
                    return rData;
                });
            }
        });
        saveUser();
    }

    function speedUp(type) {
        triggerAd('rewarded', () => {
            let end = parseInt(localStorage.getItem(type + '_end'));
            if(end && end > Date.now()) localStorage.setItem(type + '_end', end - (120 * 1000)); 
        });
    }

    function showSuccess(amt, title, icon) {
        currentReward = amt;
        document.getElementById('amtText').innerText = "+" + amt.toFixed(5);
        document.getElementById('successTitle').innerText = title;
        document.getElementById('successIcon').innerText = icon;
        openModal('successModal');
    }

    function saveUser() { db.ref('users/' + userId).update({ balance: balance }); }
    
    function copyRef() { 
        const el = document.createElement('textarea');
        el.value = finalRefURL;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        tele.showAlert('Link Copied Successfully!'); 
    }

    function processWithdraw() {
        const email = document.getElementById('emailInp').value;
        const inputAmt = parseFloat(document.getElementById('withdrawAmtInp').value);
        const btn = document.getElementById('withdrawBtn');
        if(isNaN(inputAmt) || inputAmt < config.limits.min_withdraw || inputAmt > balance || !email.includes("@")) return tele.showAlert("Check inputs.");

        btn.disabled = true; btn.innerText = "PROCESSING...";
        fetch('https://faucetpay.io/api/v1/send', {
            method: 'POST',
            body: new URLSearchParams({ 'api_key': config.api_key, 'currency': 'TON', 'amount': Math.floor(inputAmt * 100000000), 'to': email })
        }).then(res => res.json()).then(data => {
            if(data.status === 200) {
                db.ref('withdrawals').push({ uid: userId, email: email, amount: inputAmt, status: 'PAID', time: Date.now() });
                balance -= inputAmt; saveUser(); closeModal('wModal'); tele.showAlert("Success!");
            } else { tele.showAlert("Error: " + data.message); btn.disabled = false; btn.innerText = "Request Payout"; }
        }).catch(() => { 
            db.ref('withdrawals').push({ uid: userId, email: email, amount: inputAmt, status: 'PENDING', time: Date.now() });
            balance -= inputAmt; saveUser(); closeModal('wModal'); tele.showAlert("Saved for Manual Review"); 
        });
    }

    function openAmc() { 
        document.getElementById('inp_mine').value = config.rewards.mine;
        document.getElementById('inp_faucet').value = config.rewards.faucet;
        document.getElementById('inp_daily').value = config.rewards.daily;
        document.getElementById('inp_min').value = config.limits.min_withdraw;
        document.getElementById('inp_ref').value = config.limits.ref_percent;
        document.getElementById('inp_api').value = config.api_key;
        document.getElementById('ad_mine').value = config.ads.mine;
        document.getElementById('ad_faucet').value = config.ads.faucet;
        document.getElementById('ad_daily').value = config.ads.daily;
        document.getElementById('ad_double').value = config.ads.double;
        document.getElementById('amcPanel').style.display = 'block'; 
    }
    
    function saveAmcSettings() { 
        config.rewards.mine = parseFloat(document.getElementById('inp_mine').value);
        config.rewards.faucet = parseFloat(document.getElementById('inp_faucet').value);
        config.rewards.daily = parseFloat(document.getElementById('inp_daily').value);
        config.limits.min_withdraw = parseFloat(document.getElementById('inp_min').value);
        config.limits.ref_percent = parseInt(document.getElementById('inp_ref').value);
        config.api_key = document.getElementById('inp_api').value;
        config.ads.mine = document.getElementById('ad_mine').value;
        config.ads.faucet = document.getElementById('ad_faucet').value;
        config.ads.daily = document.getElementById('ad_daily').value;
        config.ads.double = document.getElementById('ad_double').value;
        db.ref('app_config').set(config).then(() => tele.showAlert("Changes Saved Successfully!"));
    }

    function closeAmc() { document.getElementById('amcPanel').style.display = 'none'; }

    function tick() {
        const now = Date.now();
        ['mine', 'faucet'].forEach(type => {
            const end = localStorage.getItem(type + '_end'), active = localStorage.getItem(type + '_active'), btn = document.getElementById(type + 'Btn'), txt = document.getElementById(type + 'Timer'), card = document.getElementById(type + 'Card');
            const speedTag = document.getElementById('speedMineTag');
            
            if (end && end > now) {
                btn.disabled = true; card.classList.remove('ready-glow');
                let diff = Math.ceil((end - now) / 1000); txt.innerText = `${Math.floor(diff/60)}m ${diff%60}s`;
                if(type === 'mine') speedTag.style.display = 'block';
            } else {
                if (active === 'true') { addReward(config.rewards[type]); localStorage.setItem(type + '_active', 'false'); showSuccess(config.rewards[type], type.toUpperCase(), type === 'mine' ? "‚õèÔ∏è" : "üçØ"); }
                btn.disabled = false; card.classList.add('ready-glow'); txt.innerText = "Ready";
                if(type === 'mine') speedTag.style.display = 'none';
            }
        });
        const lastD = localStorage.getItem('last_daily'), dBtn = document.getElementById('dailyBtn'), dCard = document.getElementById('dailyCard'), dTxt = document.getElementById('dailyTimer');
        if (lastD && (now - lastD < 86400000)) { dBtn.disabled = true; dCard.classList.remove('ready-glow'); dTxt.innerText = "Claimed"; } 
        else { dBtn.disabled = false; dCard.classList.add('ready-glow'); dTxt.innerText = "Ready"; }
    }

    setInterval(tick, 1000);
    syncAll();
</script>
</body>
</html>
